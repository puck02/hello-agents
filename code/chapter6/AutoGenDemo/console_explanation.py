"""
Console å‡½æ•°ä½œç”¨æ¼”ç¤º
å±•ç¤º Console å¦‚ä½•å°† AutoGen çš„å¯¹è¯æµå®æ—¶æ˜¾ç¤ºåœ¨ç»ˆç«¯
"""

import asyncio
# from autogen_agentchat.ui import Console  # å®é™…ä½¿ç”¨æ—¶éœ€è¦å¯¼å…¥

# ==================== Console æ˜¯ä»€ä¹ˆï¼Ÿ ====================
"""
Console æ˜¯ AutoGen æä¾›çš„ä¸€ä¸ª UI æ¸²æŸ“å™¨ï¼ˆUser Interface Rendererï¼‰

ä½œç”¨ï¼šå°†æ™ºèƒ½ä½“ä¹‹é—´çš„å¯¹è¯æµï¼ˆstreamï¼‰å®æ—¶æ˜¾ç¤ºåœ¨ç»ˆç«¯ç•Œé¢

ç±»æ¯”ï¼š
- team_chat.run_stream() â†’ äº§ç”Ÿå¯¹è¯æ•°æ®çš„"æ°´é¾™å¤´"
- Console() â†’ æŠŠ"æ°´æµ"æ˜¾ç¤ºåˆ°å±å¹•ä¸Šçš„"æ˜¾ç¤ºå™¨"
"""

# ==================== æ¨¡æ‹Ÿç¤ºä¾‹ ====================

async def simulate_agent_stream():
    """
    æ¨¡æ‹Ÿ team_chat.run_stream() çš„è¡Œä¸º
    å®ƒä¼šé€æ­¥äº§ç”Ÿæ™ºèƒ½ä½“çš„å¯¹è¯æ¶ˆæ¯
    """
    messages = [
        {"role": "ProductManager", "content": "æˆ‘æ¥åˆ†æä¸€ä¸‹éœ€æ±‚..."},
        {"role": "ProductManager", "content": "æ ¸å¿ƒåŠŸèƒ½æ˜¯æ˜¾ç¤ºæ¯”ç‰¹å¸ä»·æ ¼"},
        {"role": "Engineer", "content": "å¥½çš„ï¼Œæˆ‘å¼€å§‹ç¼–å†™ä»£ç "},
        {"role": "Engineer", "content": "ä½¿ç”¨ Streamlit + CoinGecko API"},
        {"role": "CodeReviewer", "content": "ä»£ç çœ‹èµ·æ¥ä¸é”™"},
        {"role": "UserProxy", "content": "TERMINATE"},
    ]
    
    # æ¨¡æ‹Ÿæµå¼è¾“å‡º
    for msg in messages:
        await asyncio.sleep(1)  # æ¨¡æ‹Ÿ LLM å“åº”å»¶è¿Ÿ
        yield msg  # é€ä¸ªäº§ç”Ÿæ¶ˆæ¯ï¼ˆè¿™å°±æ˜¯ streamï¼‰

# ==================== æ²¡æœ‰ Console çš„æƒ…å†µ ====================

async def without_console():
    """
    å¦‚æœä¸ä½¿ç”¨ Consoleï¼Œä½ éœ€è¦æ‰‹åŠ¨å¤„ç†æµ
    """
    print("\n" + "="*60)
    print("âŒ æ²¡æœ‰ Consoleï¼šéœ€è¦æ‰‹åŠ¨å¤„ç†")
    print("="*60)
    
    # æ‰‹åŠ¨éå†æµ
    async for message in simulate_agent_stream():
        # éœ€è¦è‡ªå·±å†™ä»£ç æ¥æ ¼å¼åŒ–å’Œæ˜¾ç¤º
        print(f"[{message['role']}]: {message['content']}")
    
    print("âœ… å¯¹è¯ç»“æŸ\n")

# ==================== ä½¿ç”¨ Console çš„æƒ…å†µ ====================

async def with_console():
    """
    ä½¿ç”¨ Consoleï¼Œå®ƒä¼šè‡ªåŠ¨å¤„ç†æ ¼å¼åŒ–å’Œæ˜¾ç¤º
    """
    print("\n" + "="*60)
    print("âœ… ä½¿ç”¨ Consoleï¼šè‡ªåŠ¨ç¾åŒ–æ˜¾ç¤º")
    print("="*60)
    
    # Console è‡ªåŠ¨å¤„ç†æµçš„æ˜¾ç¤º
    # æ³¨æ„ï¼šè¿™é‡Œä¸ºäº†æ¼”ç¤ºï¼Œæˆ‘ä»¬ç®€åŒ–äº†å®é™…çš„ Console è¡Œä¸º
    print("(å®é™…ä½¿ç”¨ä¸­ï¼ŒConsole ä¼šæä¾›æ›´ä¸°å¯Œçš„æ ¼å¼åŒ–)")
    
    async for message in simulate_agent_stream():
        # Console å†…éƒ¨ä¼šåšç±»ä¼¼è¿™æ ·çš„ç¾åŒ–å¤„ç†
        role = message['role']
        content = message['content']
        
        # æ·»åŠ é¢œè‰²ã€è¾¹æ¡†ã€æ—¶é—´æˆ³ç­‰
        icon = {
            "ProductManager": "ğŸ¯",
            "Engineer": "ğŸ’»",
            "CodeReviewer": "ğŸ”",
            "UserProxy": "ğŸ‘¤"
        }.get(role, "ğŸ’¬")
        
        print(f"\n{icon} {role}")
        print(f"â”€" * 40)
        print(f"{content}")
    
    print("\nâœ… å¯¹è¯ç»“æŸ\n")

# ==================== å®é™…ä»£ç å¯¹æ¯” ====================

def code_comparison():
    """å±•ç¤ºå®é™…ä»£ç ä¸­çš„åŒºåˆ«"""
    print("\n" + "="*60)
    print("ğŸ“ å®é™…ä»£ç ä¸­çš„ä½¿ç”¨å¯¹æ¯”")
    print("="*60)
    
    print("""
æ–¹å¼1ï¼šä¸ä½¿ç”¨ Consoleï¼ˆéº»çƒ¦ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def run_team():
    stream = team_chat.run_stream(task=task)
    
    # éœ€è¦æ‰‹åŠ¨å¤„ç†æ¯æ¡æ¶ˆæ¯
    async for message in stream:
        print(f"[{message.source}]: {message.content}")
        # è¿˜è¦å¤„ç†å„ç§æ¶ˆæ¯ç±»å‹ã€æ ¼å¼åŒ–ç­‰...
    
    return result


æ–¹å¼2ï¼šä½¿ç”¨ Consoleï¼ˆç®€å•ï¼‰
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
async def run_team():
    # Console è‡ªåŠ¨å¤„ç†ä¸€åˆ‡ï¼
    result = await Console(team_chat.run_stream(task=task))
    return result


å·®åˆ«ï¼š
- Console è‡ªåŠ¨ç¾åŒ–è¾“å‡ºæ ¼å¼
- Console å¤„ç†ä¸åŒç±»å‹çš„æ¶ˆæ¯
- Console æä¾›æ›´å¥½çš„å¯è¯»æ€§
- åªéœ€è¦ä¸€è¡Œä»£ç ï¼
    """)

# ==================== Console çš„å†…éƒ¨å·¥ä½œåŸç† ====================

def console_internals():
    """è§£é‡Š Console å†…éƒ¨åšäº†ä»€ä¹ˆ"""
    print("\n" + "="*60)
    print("ğŸ” Console å†…éƒ¨å·¥ä½œåŸç†")
    print("="*60)
    
    print("""
å½“ä½ å†™ä¸‹è¿™è¡Œä»£ç ï¼š
    result = await Console(team_chat.run_stream(task=task))

å®é™…ä¸Šå‘ç”Ÿäº†è¿™äº›äº‹æƒ…ï¼š

1ï¸âƒ£ team_chat.run_stream(task=task)
   â””â”€> è¿”å›ä¸€ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨ï¼ˆasync generatorï¼‰
   â””â”€> æ¯æ¬¡æ™ºèƒ½ä½“è¯´è¯æ—¶ï¼Œç”Ÿæˆä¸€æ¡æ¶ˆæ¯

2ï¸âƒ£ Console(...)
   â””â”€> æ¥æ”¶è¿™ä¸ªå¼‚æ­¥ç”Ÿæˆå™¨
   â””â”€> è®¢é˜…æ¶ˆæ¯æµ
   â””â”€> å¯¹æ¯æ¡æ¶ˆæ¯è¿›è¡Œå¤„ç†ï¼š
       â€¢ æ ¼å¼åŒ–æ˜¾ç¤ºï¼ˆæ·»åŠ è¾¹æ¡†ã€å›¾æ ‡ï¼‰
       â€¢ åŒºåˆ†æ¶ˆæ¯ç±»å‹ï¼ˆtextã€codeã€errorï¼‰
       â€¢ å®æ—¶æ‰“å°åˆ°ç»ˆç«¯
       â€¢ è®°å½•å®Œæ•´çš„å¯¹è¯å†å²

3ï¸âƒ£ await
   â””â”€> ç­‰å¾…æ•´ä¸ªæµå¤„ç†å®Œæˆ
   â””â”€> è¿”å›æœ€ç»ˆç»“æœ


ç±»æ¯”ç”Ÿæ´»åœºæ™¯ï¼š
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
team_chat.run_stream()  â†’ ä¼šè®®å½•éŸ³ï¼ˆåŸå§‹éŸ³é¢‘æµï¼‰
Console()               â†’ ä¼šè®®è®°å½•å‘˜ï¼ˆæ•´ç†æˆä¼šè®®çºªè¦ï¼‰
await                   â†’ ç­‰å¾…ä¼šè®®ç»“æŸ

æ²¡æœ‰ Consoleï¼šä½ å¬åˆ°çš„æ˜¯æ‚ä¹±çš„å½•éŸ³
æœ‰ Consoleï¼šä½ çœ‹åˆ°çš„æ˜¯æ•´ç†å¥½çš„ä¼šè®®çºªè¦
    """)

# ==================== æ›´å¤šç»†èŠ‚ ====================

def more_details():
    """Console çš„æ›´å¤šåŠŸèƒ½"""
    print("\n" + "="*60)
    print("âœ¨ Console çš„é¢å¤–åŠŸèƒ½")
    print("="*60)
    
    print("""
Console ä¸ä»…ä»…æ˜¯æ‰“å°ï¼Œè¿˜æä¾›ï¼š

1. ç¾åŒ–è¾“å‡º
   â€¢ ä½¿ç”¨é¢œè‰²åŒºåˆ†ä¸åŒæ™ºèƒ½ä½“
   â€¢ æ·»åŠ åˆ†éš”çº¿å’Œè¾¹æ¡†
   â€¢ æ ¼å¼åŒ–ä»£ç å—

2. å®æ—¶æµå¼æ˜¾ç¤º
   â€¢ ä¸æ˜¯ç­‰å…¨éƒ¨å®Œæˆæ‰æ˜¾ç¤º
   â€¢ æ™ºèƒ½ä½“æ¯è¯´ä¸€å¥ï¼Œç«‹å³æ˜¾ç¤º
   â€¢ ç”¨æˆ·ä½“éªŒå¥½

3. æ¶ˆæ¯åˆ†ç±»å¤„ç†
   â€¢ TextMessage â†’ æ™®é€šæ–‡æœ¬
   â€¢ ToolCallMessage â†’ å·¥å…·è°ƒç”¨
   â€¢ ToolCallResultMessage â†’ å·¥å…·ç»“æœ
   â€¢ HandoffMessage â†’ è§’è‰²åˆ‡æ¢
   â€¢ æ¯ç§ç±»å‹éƒ½æœ‰ä¸åŒçš„æ˜¾ç¤ºæ ·å¼

4. é”™è¯¯å¤„ç†
   â€¢ ä¼˜é›…åœ°æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
   â€¢ ä¿ç•™å®Œæ•´çš„å †æ ˆè·Ÿè¸ª

5. å¯¹è¯å†å²
   â€¢ å¯ä»¥è¿”å›å®Œæ•´çš„å¯¹è¯è®°å½•
   â€¢ æ–¹ä¾¿åç»­åˆ†æ
    """)

# ==================== æ›¿ä»£æ–¹æ¡ˆ ====================

def alternatives():
    """å¦‚æœä¸ç”¨ Console æ€ä¹ˆåŠï¼Ÿ"""
    print("\n" + "="*60)
    print("ğŸ”„ Console çš„æ›¿ä»£æ–¹æ¡ˆ")
    print("="*60)
    
    print("""
AutoGen æä¾›äº†å¤šç§ UI æ¸²æŸ“å™¨ï¼š

1. Console (å‘½ä»¤è¡Œ)
   from autogen_agentchat.ui import Console
   result = await Console(stream)
   â†’ ç»ˆç«¯ä¸­å®æ—¶æ˜¾ç¤º

2. Inline (Jupyter Notebook)
   from autogen_agentchat.ui import Inline
   result = await Inline(stream)
   â†’ åœ¨ Notebook å•å…ƒæ ¼ä¸­æ˜¾ç¤º

3. è‡ªå®šä¹‰å¤„ç†
   async for message in stream:
       # ä½ è‡ªå·±çš„å¤„ç†é€»è¾‘
       custom_display(message)
   â†’ å®Œå…¨è‡ªå®šä¹‰æ˜¾ç¤ºæ–¹å¼

4. ä¸æ˜¾ç¤ºï¼ˆé™é»˜è¿è¡Œï¼‰
   result = await team_chat.run(task=task)
   â†’ åªè¿”å›ç»“æœï¼Œä¸æ˜¾ç¤ºè¿‡ç¨‹
    """)

# ==================== ä¸»ç¨‹åº ====================

async def main():
    """è¿è¡Œæ‰€æœ‰æ¼”ç¤º"""
    print("\n" + "ğŸ¬ Console å‡½æ•°ä½œç”¨æ¼”ç¤º" + "\n")
    
    # 1. æ²¡æœ‰ Console
    await without_console()
    
    await asyncio.sleep(1)
    
    # 2. ä½¿ç”¨ Console
    await with_console()
    
    # 3. ä»£ç å¯¹æ¯”
    code_comparison()
    
    # 4. å†…éƒ¨åŸç†
    console_internals()
    
    # 5. æ›´å¤šç»†èŠ‚
    more_details()
    
    # 6. æ›¿ä»£æ–¹æ¡ˆ
    alternatives()
    
    print("\n" + "="*60)
    print("ğŸ“Œ æ€»ç»“")
    print("="*60)
    print("""
Console å‡½æ•°çš„ä½œç”¨ï¼š

ç®€å•è¯´ï¼šæŠŠæ™ºèƒ½ä½“å¯¹è¯"æµ"å®æ—¶æ˜¾ç¤ºåˆ°ç»ˆç«¯
è¯¦ç»†è¯´ï¼š
  â€¢ æ¥æ”¶å¼‚æ­¥æ¶ˆæ¯æµï¼ˆstreamï¼‰
  â€¢ è‡ªåŠ¨æ ¼å¼åŒ–ç¾åŒ–
  â€¢ å®æ—¶æ‰“å°åˆ°ç»ˆç«¯
  â€¢ æå‡ç”¨æˆ·ä½“éªŒ

ä¸ºä»€ä¹ˆè¦ç”¨ï¼š
  â€¢ çœå»æ‰‹åŠ¨å¤„ç†çš„éº»çƒ¦
  â€¢ æä¾›ç»Ÿä¸€ç¾è§‚çš„æ˜¾ç¤ºæ ¼å¼
  â€¢ åªéœ€è¦ä¸€è¡Œä»£ç 
  â€¢ æ˜¯ AutoGen æ¨èçš„æ ‡å‡†åšæ³•

å®é™…ä»£ç ï¼š
  result = await Console(team_chat.run_stream(task=task))
            â†‘      â†‘                       â†‘
            |      |                       â””â”€ äº§ç”Ÿæ¶ˆæ¯æµ
            |      â””â”€ è‡ªåŠ¨æ˜¾ç¤ºæ¶ˆæ¯
            â””â”€ ç­‰å¾…å®Œæˆ
    """)

if __name__ == "__main__":
    asyncio.run(main())
